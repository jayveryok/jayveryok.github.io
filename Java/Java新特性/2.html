<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JDK8-17新特性（下） | 剑指Java</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.ff0089cb.css" as="style"><link rel="preload" href="/assets/js/app.56b30d8d.js" as="script"><link rel="preload" href="/assets/js/2.86de0245.js" as="script"><link rel="preload" href="/assets/js/9.ef364674.js" as="script"><link rel="prefetch" href="/assets/js/10.819815f4.js"><link rel="prefetch" href="/assets/js/11.e9593e52.js"><link rel="prefetch" href="/assets/js/12.c39a39d6.js"><link rel="prefetch" href="/assets/js/13.b1b731bd.js"><link rel="prefetch" href="/assets/js/14.77c8e74e.js"><link rel="prefetch" href="/assets/js/15.99135f42.js"><link rel="prefetch" href="/assets/js/16.7f2b4799.js"><link rel="prefetch" href="/assets/js/17.578d1722.js"><link rel="prefetch" href="/assets/js/18.a274a341.js"><link rel="prefetch" href="/assets/js/19.1e0c14bd.js"><link rel="prefetch" href="/assets/js/20.c11111bd.js"><link rel="prefetch" href="/assets/js/21.64c62fcc.js"><link rel="prefetch" href="/assets/js/22.da87a405.js"><link rel="prefetch" href="/assets/js/23.3c31f829.js"><link rel="prefetch" href="/assets/js/24.a50a01fd.js"><link rel="prefetch" href="/assets/js/25.e7cc4ccd.js"><link rel="prefetch" href="/assets/js/26.7071cc05.js"><link rel="prefetch" href="/assets/js/27.0dae68aa.js"><link rel="prefetch" href="/assets/js/28.354a335c.js"><link rel="prefetch" href="/assets/js/29.4b4bc756.js"><link rel="prefetch" href="/assets/js/3.3ed0263e.js"><link rel="prefetch" href="/assets/js/4.bfed7cfb.js"><link rel="prefetch" href="/assets/js/5.afd0634d.js"><link rel="prefetch" href="/assets/js/6.14e7681a.js"><link rel="prefetch" href="/assets/js/7.4db0caaa.js"><link rel="prefetch" href="/assets/js/8.f2c976d1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ff0089cb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">剑指Java</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/概述/1.html" class="nav-link">
  概述
</a></li><li class="dropdown-item"><!----> <a href="/Java/基础入门/1.html" class="nav-link">
  基础入门
</a></li><li class="dropdown-item"><!----> <a href="/Java/面向对象/1.html" class="nav-link">
  面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Java/Java高级/1.html" class="nav-link">
  Java高级
</a></li><li class="dropdown-item"><!----> <a href="/Java/Java集合/1.html" class="nav-link">
  Java集合
</a></li><li class="dropdown-item"><!----> <a href="/Java/Java并发/1.html" class="nav-link">
  Java并发
</a></li><li class="dropdown-item"><!----> <a href="/Java/Java虚拟机/1.html" class="nav-link">
  Java虚拟机
</a></li><li class="dropdown-item"><!----> <a href="/Java/Java新特性/1.html" class="nav-link">
  Java新特性
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  MyBatis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务" class="dropdown-title"><span class="title">微服务</span> <span class="arrow down"></span></button> <button type="button" aria-label="微服务" class="mobile-dropdown-title"><span class="title">微服务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  Dubbo
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/概述/1.html" class="nav-link">
  概述
</a></li><li class="dropdown-item"><!----> <a href="/Java/基础入门/1.html" class="nav-link">
  基础入门
</a></li><li class="dropdown-item"><!----> <a href="/Java/面向对象/1.html" class="nav-link">
  面向对象
</a></li><li class="dropdown-item"><!----> <a href="/Java/Java高级/1.html" class="nav-link">
  Java高级
</a></li><li class="dropdown-item"><!----> <a href="/Java/Java集合/1.html" class="nav-link">
  Java集合
</a></li><li class="dropdown-item"><!----> <a href="/Java/Java并发/1.html" class="nav-link">
  Java并发
</a></li><li class="dropdown-item"><!----> <a href="/Java/Java虚拟机/1.html" class="nav-link">
  Java虚拟机
</a></li><li class="dropdown-item"><!----> <a href="/Java/Java新特性/1.html" class="nav-link">
  Java新特性
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  MyBatis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务" class="dropdown-title"><span class="title">微服务</span> <span class="arrow down"></span></button> <button type="button" aria-label="微服务" class="mobile-dropdown-title"><span class="title">微服务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/temp.html" class="nav-link">
  Dubbo
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>概述</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面向对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java高级</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java集合</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java并发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java虚拟机</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java新特性</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/Java新特性/1.html" class="sidebar-link">JDK8-17新特性（上）</a></li><li><a href="/Java/Java新特性/2.html" class="active sidebar-link">JDK8-17新特性（下）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java/Java新特性/2.html#_6-新语法结构" class="sidebar-link">6. 新语法结构</a></li><li class="sidebar-sub-header"><a href="/Java/Java新特性/2.html#_7-api的变化" class="sidebar-link">7. API的变化</a></li><li class="sidebar-sub-header"><a href="/Java/Java新特性/2.html#description" class="sidebar-link">Description</a></li><li class="sidebar-sub-header"><a href="/Java/Java新特性/2.html#_8-其它结构变化" class="sidebar-link">8.  其它结构变化</a></li><li class="sidebar-sub-header"><a href="/Java/Java新特性/2.html#_9-小结与展望" class="sidebar-link">9. 小结与展望</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jdk8-17新特性-下"><a href="#jdk8-17新特性-下" class="header-anchor">#</a> JDK8-17新特性（下）</h1> <h2 id="_6-新语法结构"><a href="#_6-新语法结构" class="header-anchor">#</a> 6. 新语法结构</h2> <p>新的语法结构，为我们勾勒出了 Java 语法进化的一个趋势，将开发者从<code>复杂、繁琐</code>的低层次抽象中逐渐解放出来，以更高层次、更优雅的抽象，既<code>降低代码量</code>，又避免意外编程错误的出现，进而提高代码质量和开发效率。</p> <h3 id="_6-1-java的repl工具-jshell命令"><a href="#_6-1-java的repl工具-jshell命令" class="header-anchor">#</a> 6.1 Java的REPL工具： jShell命令</h3> <p><strong>JDK9的新特性</strong></p> <p>Java 终于拥有了像Python 和 Scala 之类语言的REPL工具（交互式编程环境，read - evaluate - print - loop）：<code>jShell</code>。以交互式的方式对语句和表达式进行求值。<code>即写即得</code>、<code>快速运行</code>。</p> <p>利用jShell在没有创建类的情况下，在命令行里直接声明变量，计算表达式，执行语句。无需跟人解释”public static void main(String[] args)”这句&quot;废话&quot;。</p> <p><strong>使用举例</strong></p> <ul><li>调出jShell</li></ul> <p><img alt="image-20220527205410620" data-src="images/image-20220527205410620.png" loading="lazy" class="lazy"></p> <ul><li>获取帮助</li></ul> <p><img alt="image-20220527205418073" data-src="images/image-20220527205418073.png" loading="lazy" class="lazy"></p> <ul><li>基本使用</li></ul> <p><img alt="image-20220527205429720" data-src="images/image-20220527205429720.png" loading="lazy" class="lazy"></p> <ul><li>导入指定的包</li></ul> <p><img alt="image-20220527205440068" data-src="images/image-20220527205440068.png" loading="lazy" class="lazy"></p> <ul><li>默认已经导入如下的所有包：（包含java.lang包）</li></ul> <p><img alt="image-20220527205445267" data-src="images/image-20220527205445267.png" loading="lazy" class="lazy"></p> <ul><li>只需按下 Tab 键，就能自动补全代码</li></ul> <p><img alt="image-20220527205451352" data-src="images/image-20220527205451352.png" loading="lazy" class="lazy"></p> <ul><li>列出当前 session 里所有有效的代码片段</li></ul> <p><img alt="image-20220527205458774" data-src="images/image-20220527205458774.png" loading="lazy" class="lazy"></p> <ul><li>查看当前 session 下所有创建过的变量</li></ul> <p><img alt="image-20220527205506632" data-src="images/image-20220527205506632.png" loading="lazy" class="lazy"></p> <ul><li>查看当前 session 下所有创建过的方法</li></ul> <p><img alt="image-20220527205513459" data-src="images/image-20220527205513459.png" loading="lazy" class="lazy"></p> <blockquote><p>Tips：我们还可以重新定义相同方法名和参数列表的方法，即对现有方法的修改（或覆盖）。</p></blockquote> <ul><li>使用外部代码编辑器来编写 Java 代码</li></ul> <p><img alt="image-20220527205519915" data-src="images/image-20220527205519915.png" loading="lazy" class="lazy"></p> <p>从外部文件加载源代码【HelloWorld.java】</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Created by songhongkang
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;马上2023年了，尚硅谷祝所有的谷粉元旦快乐！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">printHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>使用/open命令调用</li></ul> <p><img alt="image-20220527205827712" data-src="images/image-20220527205827712.png" loading="lazy" class="lazy"></p> <ul><li>退出jShell</li></ul> <p><img alt="image-20220527205904000" data-src="images/image-20220527205904000.png" loading="lazy" class="lazy"></p> <h3 id="_6-2-异常处理之try-catch资源关闭"><a href="#_6-2-异常处理之try-catch资源关闭" class="header-anchor">#</a> 6.2 异常处理之try-catch资源关闭</h3> <p>在JDK7 之前，我们这样处理资源的关闭：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">FileWriter</span> fw <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">BufferedWriter</span> bw <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        fw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span><span class="token string">&quot;d:/1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span>fw<span class="token punctuation">)</span><span class="token punctuation">;</span>

        bw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bw <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                bw<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fw <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                fw<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>JDK7的新特性</strong></p> <p>在try的后面可以增加一个()，在括号中可以声明流对象并初始化。try中的代码执行完毕，会自动把流对象释放，就不用写finally了。</p> <p>格式：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span><span class="token punctuation">(</span>资源对象的声明和初始化<span class="token punctuation">)</span><span class="token punctuation">{</span>
    业务逻辑代码<span class="token punctuation">,</span>可能会产生异常
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>异常类型<span class="token number">1</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    处理异常代码
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>异常类型<span class="token number">2</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    处理异常代码
<span class="token punctuation">}</span>
</code></pre></div><p>说明：</p> <p>1、在try()中声明的资源，无论是否发生异常，无论是否处理异常，都会自动关闭资源对象，不用手动关闭了。</p> <p>2、这些资源实现类必须实现AutoCloseable或Closeable接口，实现其中的close()方法。Closeable是AutoCloseable的子接口。Java7几乎把所有的“资源类”（包括文件IO的各种类、JDBC编程的Connection、Statement等接口…）都进行了改写，改写后资源类都实现了AutoCloseable或Closeable接口，并实现了close()方法。</p> <p>3、写到try()中的资源类的变量默认是final声明的，不能修改。</p> <p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//举例1</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span>
        <span class="token class-name">FileWriter</span> fw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span><span class="token string">&quot;d:/1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedWriter</span> bw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span>fw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//举例2</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//从d:/1.txt(utf-8)文件中，读取内容，写到项目根目录下1.txt(gbk)文件中</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span>
        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;d:/1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStreamReader</span> isr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>fis<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>isr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStreamWriter</span> osw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span>fos<span class="token punctuation">,</span> <span class="token string">&quot;gbk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedWriter</span> bw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span>osw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>str <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            bw<span class="token punctuation">.</span><span class="token function">newLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>JDK9的新特性</strong></p> <p>try的前面可以定义流对象，try后面的()中可以直接引用流对象的名称。在try代码执行完毕后，流对象也可以释放掉，也不用写finally了。</p> <p>格式：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">A</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">B</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">(</span>a<span class="token punctuation">;</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>
    可能产生的异常代码
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>异常类名 变量名<span class="token punctuation">)</span><span class="token punctuation">{</span>
    异常处理的逻辑
<span class="token punctuation">}</span>
</code></pre></div><p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">InputStreamReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">OutputStreamWriter</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span>reader<span class="token punctuation">;</span> writer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//reader是final的，不可再被赋值</span>
        <span class="token comment">//   reader = null;</span>

    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-3-局部变量类型推断"><a href="#_6-3-局部变量类型推断" class="header-anchor">#</a> 6.3 局部变量类型推断</h3> <p><strong>JDK 10的新特性</strong></p> <p>局部变量的显示类型声明，常常被认为是不必须的，给一个好听的名字反而可以很清楚的表达出下面应该怎样继续。本新特性允许开发人员省略通常不必要的局部变量类型声明，以增强Java语言的体验性、可读性。</p> <ul><li>使用举例</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//1.局部变量的实例化</span>
<span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2.增强for循环中的索引</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//3.传统for循环中</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//4. 返回值类型含复杂泛型结构</span>
<span class="token keyword">var</span> iterator <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Iterator&lt;Map.Entry&lt;Integer, Student&gt;&gt; iterator = set.iterator();</span>

</code></pre></div><ul><li>不适用场景
<ul><li>声明一个成员变量</li> <li>声明一个数组变量，并为数组静态初始化（省略new的情况下）</li> <li>方法的返回值类型</li> <li>方法的参数类型</li> <li>没有初始化的方法内的局部变量声明</li> <li>作为catch块中异常类型</li> <li>Lambda表达式中函数式接口的类型</li> <li>方法引用中函数式接口的类型</li></ul></li></ul> <p>代码举例：</p> <p>声明一个成员变量，并初始化值为null</p> <p><img alt="image-20220528155628337" data-src="images/image-20220528155628337.png" loading="lazy" class="lazy"></p> <p>声明一个数组变量，并为数组静态初始化（省略new的情况下）</p> <p><img alt="image-20220528155436304" data-src="images/image-20220528155436304.png" loading="lazy" class="lazy"></p> <p>没有初始化的方法内的局部变量声明</p> <p><img alt="image-20220528155525774" data-src="images/image-20220528155525774.png" loading="lazy" class="lazy"></p> <p>方法的返回值类型</p> <p><img alt="image-20220528155537713" data-src="images/image-20220528155537713.png" loading="lazy" class="lazy"></p> <p>方法的参数类型</p> <p><img alt="image-20220528155549303" data-src="images/image-20220528155549303.png" loading="lazy" class="lazy"></p> <p>构造器的参数类型</p> <p><img alt="image-20220528155614708" data-src="images/image-20220528155614708.png" loading="lazy" class="lazy"></p> <p>作为catch块中异常类型</p> <p><img alt="image-20220528155640498" data-src="images/image-20220528155640498.png" loading="lazy" class="lazy"></p> <p>Lambda表达式中函数式接口的类型</p> <p><img alt="image-20220528155423180" data-src="images/image-20220528155423180.png" loading="lazy" class="lazy"></p> <p>方法引用中函数式接口的类型</p> <p><img alt="image-20220528155429055" data-src="images/image-20220528155429055.png" loading="lazy" class="lazy"></p> <p><strong>注意：</strong></p> <ul><li><p>var不是一个关键字，而是一个类型名，将它作为变量的类型。不能使用var作为类名。</p></li> <li><p>这不是JavaScript。var并不会改变 Java是一门静态类型语言的事实。编译器负责推断出类型，并把结果写入字节码文件，就好像是开发人员自己敲入类型一样。</p></li></ul> <h3 id="_6-4-instanceof的模式匹配"><a href="#_6-4-instanceof的模式匹配" class="header-anchor">#</a> 6.4 instanceof的模式匹配</h3> <p><strong>JDK14中预览特性：</strong></p> <p>instanceof 模式匹配通过提供更为简便的语法，来提高生产力。有了该功能，可以减少Java程序中显式强制转换的数量，实现更精确、简洁的类型安全的代码。</p> <p>Java 14之前旧写法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>obj<span class="token punctuation">;</span> <span class="token comment">//需要强转</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span> str<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Java 14新特性写法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span> str<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * instanceof的模式匹配（预览）
 *
 * @author shkstart
 * @create 上午 11:32
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Feature01</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;hello,Java14&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//在使用null 匹配instanceof 时，返回都是false.</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;Java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;非String类型&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//举例1：</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//新特性：省去了强制类型转换的过程</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;Java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;非String类型&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 举例2</span>
<span class="token keyword">class</span> <span class="token class-name">InstanceOf</span><span class="token punctuation">{</span>

    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//此时的str的作用域仅限于if结构内。</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">//举例3：</span>
<span class="token keyword">class</span> <span class="token class-name">Monitor</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> model<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> price<span class="token punctuation">;</span>

<span class="token comment">//    public boolean equals(Object o){</span>
<span class="token comment">//        if(o instanceof Monitor other){</span>
<span class="token comment">//            if(model.equals(other.model) &amp;&amp; price == other.price){</span>
<span class="token comment">//                return true;</span>
<span class="token comment">//            }</span>
<span class="token comment">//        }</span>
<span class="token comment">//        return false;</span>
<span class="token comment">//    }</span>


    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> o <span class="token keyword">instanceof</span> <span class="token class-name">Monitor</span> other <span class="token operator">&amp;&amp;</span> model<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>model<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> price <span class="token operator">==</span> other<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong>JDK15中第二次预览：</strong></p> <p>没有任何更改。</p> <p><strong>JDK16中转正特性：</strong></p> <p>在Java16中转正。</p> <h3 id="_6-5-switch表达式"><a href="#_6-5-switch表达式" class="header-anchor">#</a> 6.5 switch表达式</h3> <p>传统switch声明语句的弊端：</p> <ul><li>匹配是自上而下的，如果忘记写break，后面的case语句不论匹配与否都会执行； ---&gt;case穿透</li> <li>所有的case语句共用一个块范围，在不同的case语句定义的变量名不能重复；</li> <li>不能在一个case里写多个执行结果一致的条件；</li> <li>整个switch不能作为表达式返回值；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//常见错误实现</span>
<span class="token keyword">switch</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">|</span><span class="token number">4</span><span class="token operator">|</span><span class="token number">5</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">3</span><span class="token operator">|</span><span class="token number">4</span><span class="token operator">|</span><span class="token number">5</span> 用了位运算符，<span class="token number">11</span> <span class="token operator">|</span> <span class="token number">100</span> <span class="token operator">|</span> <span class="token number">101</span>结果是 <span class="token number">111</span>是<span class="token number">7</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;春季&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">|</span><span class="token number">7</span><span class="token operator">|</span><span class="token number">8</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">6</span><span class="token operator">|</span><span class="token number">7</span><span class="token operator">|</span><span class="token number">8</span>用了位运算符，<span class="token number">110</span> <span class="token operator">|</span> <span class="token number">111</span> <span class="token operator">|</span> <span class="token number">1000</span>结果是<span class="token number">1111</span>是<span class="token number">15</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;夏季&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">|</span><span class="token number">10</span><span class="token operator">|</span><span class="token number">11</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">9</span><span class="token operator">|</span><span class="token number">10</span><span class="token operator">|</span><span class="token number">11</span>用了位运算符，<span class="token number">1001</span> <span class="token operator">|</span> <span class="token number">1010</span> <span class="token operator">|</span> <span class="token number">1011</span>结果是<span class="token number">1011</span>是<span class="token number">11</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;秋季&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">12</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span><span class="token number">2</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">|</span><span class="token number">1</span><span class="token operator">|</span><span class="token number">2</span> 用了位运算符，<span class="token number">1100</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">10</span> 结果是<span class="token number">1111</span>，是<span class="token number">15</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;冬季&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;输入有误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>JDK12中预览特性：</strong></p> <ul><li><p>Java 12将会对switch声明语句进行扩展，使用<code>case L -&gt;</code>来替代以前的<code>break;</code>，省去了 break 语句，避免了因少写 break 而出错。</p></li> <li><p>同时将多个 case 合并到一行，显得简洁、清晰，也更加优雅的表达逻辑分支。</p></li> <li><p>为了保持兼容性，case 条件语句中依然可以使用字符<code>:</code> ，但是同一个 switch 结构里不能混用<code>-&gt;</code> 和<code>:</code> ，否则编译错误。</p></li></ul> <p>举例：</p> <p>Java 12之前</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * @author shkstart
 * @create 下午 4:47
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwitchTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> numberOfLetters<span class="token punctuation">;</span>
        <span class="token class-name">Fruit</span> fruit <span class="token operator">=</span> <span class="token class-name">Fruit</span><span class="token punctuation">.</span><span class="token constant">APPLE</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>fruit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">PEAR</span><span class="token operator">:</span>
                numberOfLetters <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">APPLE</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token constant">GRAPE</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token constant">MANGO</span><span class="token operator">:</span>
                numberOfLetters <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">ORANGE</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token constant">PAPAYA</span><span class="token operator">:</span>
                numberOfLetters <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;No Such Fruit:&quot;</span> <span class="token operator">+</span> fruit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>numberOfLetters<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">enum</span> <span class="token class-name">Fruit</span> <span class="token punctuation">{</span>
    <span class="token constant">PEAR</span><span class="token punctuation">,</span> <span class="token constant">APPLE</span><span class="token punctuation">,</span> <span class="token constant">GRAPE</span><span class="token punctuation">,</span> <span class="token constant">MANGO</span><span class="token punctuation">,</span> <span class="token constant">ORANGE</span><span class="token punctuation">,</span> <span class="token constant">PAPAYA</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>switch 语句如果漏写了一个 break，那么逻辑往往就跑偏了，这种方式既繁琐，又容易出错。</p> <p>Java 12中：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * @author shkstart
 * @create 下午 10:38
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwitchTest1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Fruit</span> fruit <span class="token operator">=</span> <span class="token class-name">Fruit</span><span class="token punctuation">.</span><span class="token constant">GRAPE</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">PEAR</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">APPLE</span><span class="token punctuation">,</span><span class="token constant">MANGO</span><span class="token punctuation">,</span><span class="token constant">GRAPE</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">ORANGE</span><span class="token punctuation">,</span><span class="token constant">PAPAYA</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span> <span class="token operator">-&gt;</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;No Such Fruit:&quot;</span> <span class="token operator">+</span> fruit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>更进一步：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * @author shkstart
 * @create 2019 下午 10:44
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwitchTest2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Fruit</span> fruit <span class="token operator">=</span> <span class="token class-name">Fruit</span><span class="token punctuation">.</span><span class="token constant">GRAPE</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> numberOfLetters <span class="token operator">=</span> <span class="token keyword">switch</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token constant">PEAR</span> <span class="token operator">-&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">APPLE</span><span class="token punctuation">,</span><span class="token constant">MANGO</span><span class="token punctuation">,</span><span class="token constant">GRAPE</span> <span class="token operator">-&gt;</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">ORANGE</span><span class="token punctuation">,</span><span class="token constant">PAPAYA</span> <span class="token operator">-&gt;</span> <span class="token number">6</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span> <span class="token operator">-&gt;</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;No Such Fruit:&quot;</span> <span class="token operator">+</span> fruit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>numberOfLetters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>JDK13中二次预览特性：</strong></p> <p>JDK13中引入了yield语句，用于返回值。这意味着，switch表达式(返回值)应该使用yield，switch语句(不返回值)应该使用break。</p> <p>yield和return的区别在于：return会直接跳出当前循环或者方法，而yield只会跳出当前switch块。</p> <p>在以前：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSwitch1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> x <span class="token operator">=</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;1&quot;</span><span class="token operator">:</span>
            i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">&quot;2&quot;</span><span class="token operator">:</span>
            i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            i <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在JDK13中：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSwitch2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> x <span class="token operator">=</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;1&quot;</span> <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">&quot;2&quot;</span> <span class="token operator">-&gt;</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSwitch3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> x <span class="token operator">=</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;1&quot;</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">&quot;2&quot;</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>JDK14中转正特性：</strong></p> <p>这是JDK 12和JDK 13中的预览特性，现在是正式特性了。</p> <p><strong>JDK17的预览特性：switch的模式匹配</strong></p> <p>旧写法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">formatter</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> formatted <span class="token operator">=</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        formatted <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;int %d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Long</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        formatted <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;long %d&quot;</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Double</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        formatted <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;double %f&quot;</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        formatted <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;String %s&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> formatted<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>模式匹配新写法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">formatterPatternSwitch</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token class-name">Integer</span> i <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;int %d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">Long</span> l    <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;long %d&quot;</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">Double</span> d  <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;double %f&quot;</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">String</span> s  <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;String %s&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span>        <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>直接在 switch 上支持 Object 类型，这就等于同时支持多种类型，使用模式匹配得到具体类型，大大简化了语法量，这个功能很实用。</p> <h3 id="_6-6-文本块"><a href="#_6-6-文本块" class="header-anchor">#</a> 6.6 文本块</h3> <p>现实问题：</p> <p>在Java中，通常需要使用String类型表达HTML，XML，SQL或JSON等格式的字符串，在进行字符串赋值时需要进行转义和连接操作，然后才能编译该代码，这种表达方式难以阅读并且难以维护。</p> <p><strong>JDK13的新特性</strong></p> <p>使用&quot;&quot;&quot;作为文本块的开始符和结束符，在其中就可以放置多行的字符串，不需要进行任何转义。因此，文本块将提高Java程序的可读性和可写性。</p> <p>基本使用：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
line1
line2
line3
&quot;&quot;&quot;</span>
</code></pre></div><p>相当于：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token string">&quot;line1\nline2\nline3\n&quot;</span>
</code></pre></div><p>或者一个连接的字符串：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token string">&quot;line1\n&quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;line2\n&quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;line3\n&quot;</span>
</code></pre></div><p>如果字符串末尾不需要行终止符，则结束分隔符可以放在最后一行内容上。例如：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
line1
line2
line3&quot;&quot;&quot;</span>
</code></pre></div><p>相当于</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token string">&quot;line1\nline2\nline3&quot;</span>
</code></pre></div><p>文本块可以表示空字符串，但不建议这样做，因为它需要两行源代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> empty <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
&quot;&quot;&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>举例1：普通文本</p> <p>原有写法：</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name">String</span> text1 <span class="token operator">=</span> <span class="token string">&quot;The Sound of silence\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;Hello darkness, my old friend\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;I've come to talk with you again\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;Because a vision softly creeping\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;Left its seeds while I was sleeping\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;And the vision that was planted in my brain\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;Still remains\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;Within the sound of silence&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>text1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用新特性：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> text2 <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
                The Sound of silence
                Hello darkness, my old friend
                I've come to talk with you again
                Because a vision softly creeping
                Left its seeds while I was sleeping
                And the vision that was planted in my brain
                Still remains
                Within the sound of silence
                &quot;&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>text2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>举例2：HTML语句</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Hello, 尚硅谷<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>将其复制到Java的字符串中，会展示成以下内容：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token string">&quot;&lt;html&gt;\n&quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;    &lt;body&gt;\n&quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;        &lt;p&gt;Hello, 尚硅谷&lt;/p&gt;\n&quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;    &lt;/body&gt;\n&quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;&lt;/html&gt;\n&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>即被自动进行了转义，这样的字符串看起来不是很直观，在JDK 13中：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
&lt;html&gt;
  &lt;body&gt;
      &lt;p&gt;Hello, world&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>举例3：SQL语句</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>department_id
<span class="token keyword">from</span> employees
<span class="token keyword">where</span> department_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> department_id <span class="token keyword">asc</span>
</code></pre></div><p>原有方式：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;SELECT id,NAME,email\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;FROM customers\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;WHERE id &gt; 4\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;ORDER BY email DESC&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>使用新特性：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> sql1 <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
                SELECT id,NAME,email
                FROM customers
                WHERE id &gt; 4
                ORDER BY email DESC
                &quot;&quot;&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>举例4：JSON字符串</p> <p>原有方式：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> myJson <span class="token operator">=</span> <span class="token string">&quot;{\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;name\&quot;:\&quot;Song Hongkang\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;     \&quot;address\&quot;:\&quot;www.atguigu.com\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;email\&quot;:\&quot;shkstart@126.com\&quot;\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;}&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>myJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用新特性：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> myJson1 <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
                {
                    &quot;name&quot;:&quot;Song Hongkang&quot;,
                     &quot;address&quot;:&quot;www.atguigu.com&quot;,
                    &quot;email&quot;:&quot;shkstart@126.com&quot;
                }&quot;&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>myJson1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>JDK14中二次预览特性</strong></p> <p>JDK14的版本主要增加了两个escape sequences，分别是<code>\ &lt;line-terminator&gt;</code>与<code>\s escape sequence</code>。</p> <p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * @author shkstart
 * @create 下午 7:13
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Feature05</span> <span class="token punctuation">{</span>
    <span class="token comment">//jdk14新特性</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql1 <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
                SELECT id,NAME,email
                FROM customers
                WHERE id &gt; 4
                ORDER BY email DESC
                &quot;&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sql1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \:取消换行操作</span>
        <span class="token comment">// \s:表示一个空格</span>
        <span class="token class-name">String</span> sql2 <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>&quot;
                <span class="token class-name">SELECT</span> id<span class="token punctuation">,</span><span class="token constant">NAME</span><span class="token punctuation">,</span>email \
                <span class="token constant">FROM</span> customers\s\
                <span class="token constant">WHERE</span> id <span class="token operator">&gt;</span> <span class="token number">4</span> \
                <span class="token constant">ORDER</span> <span class="token constant">BY</span> email <span class="token constant">DESC</span>
                <span class="token string">&quot;&quot;</span>&quot;<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sql2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>JDK15中功能转正</strong></p> <h3 id="_6-7-record"><a href="#_6-7-record" class="header-anchor">#</a> 6.7 Record</h3> <p><code>背景</code></p> <p>早在2019年2月份，Java 语言架构师 Brian Goetz，曾写文抱怨“<code>Java太啰嗦</code>”或有太多的“繁文缛节”。他提到：开发人员想要创建纯数据载体类（plain data carriers）通常都必须编写大量低价值、重复的、容易出错的代码。如：构造函数、getter/setter、equals()、hashCode()以及toString()等。</p> <p>以至于很多人选择使用IDE的功能来自动生成这些代码。还有一些开发会选择使用一些第三方类库，如Lombok等来生成这些方法。</p> <p>**JDK14中预览特性：神说要用record，于是就有了。**实现一个简单的数据载体类，为了避免编写：构造函数，访问器，equals()，hashCode () ，toString ()等，Java 14推出record。</p> <p><code>record</code> 是一种全新的类型，它本质上是一个 <code>final</code> 类，同时所有的属性都是 <code>final</code> 修饰，它会自动编译出 <code>public get</code> 、<code>hashcode</code> 、<code>equals</code>、<code>toString</code>、构造器等结构，减少了代码编写量。</p> <p>具体来说：当你用<code>record</code> 声明一个类时，该类将自动拥有以下功能：</p> <ul><li>获取成员变量的简单方法，比如例题中的 name() 和 partner() 。注意区别于我们平常getter()的写法。</li> <li>一个 equals 方法的实现，执行比较时会比较该类的所有成员属性。</li> <li>重写 hashCode() 方法。</li> <li>一个可以打印该类所有成员属性的 toString() 方法。</li> <li>只有一个构造方法。</li></ul> <p>此外：</p> <ul><li><p>还可以在record声明的类中定义静态字段、静态方法、构造器或实例方法。</p></li> <li><p>不能在record声明的类中定义实例字段；类不能声明为abstract；不能声明显式的父类等。</p></li></ul> <p>举例1（旧写法）：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> y<span class="token punctuation">;</span>

    <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Point</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">Point</span> other <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Point</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
        <span class="token keyword">return</span> other<span class="token punctuation">.</span>x <span class="token operator">==</span> x <span class="token operator">&amp;&amp;</span> other<span class="token punctuation">.</span>y <span class="token operator">==</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Point{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;x=&quot;</span> <span class="token operator">+</span> x <span class="token operator">+</span>
                <span class="token string">&quot;, y=&quot;</span> <span class="token operator">+</span> y <span class="token operator">+</span>
                <span class="token char">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>举例1（新写法）：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">record</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><p>举例1：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Java14Record</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Dog</span> dog1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">&quot;牧羊犬&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Dog</span> dog2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">&quot;田园犬&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Dog</span> dog3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">&quot;哈士奇&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>举例2：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 *  Record类型的演示
 *
 * @author shkstart
 * @create 下午 6:13
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Feature07</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//测试构造器</span>
        <span class="token class-name">Person</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;罗密欧&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;zhuliye&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//测试toString()</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//测试equals():</span>
        <span class="token class-name">Person</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;罗密欧&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;zhuliye&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//测试hashCode()和equals()</span>
        <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Person</span> person <span class="token operator">:</span> set<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//测试name()和partner():类似于getName()和getPartner()</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span><span class="token function">partner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Person</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;zhuyingtai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span><span class="token function">getNameInUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Person</span><span class="token punctuation">.</span>nation <span class="token operator">=</span> <span class="token string">&quot;CHN&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token function">showNation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * @author shkstart
 * @create 下午 6:20
 */</span>
<span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token class-name">Person</span> partner<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//还可以声明静态的属性、静态的方法、构造器、实例方法</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> nation<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">showNation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> nation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNameInUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//不可以声明非静态的属性</span>
<span class="token comment">//    private int id;//报错</span>
<span class="token punctuation">}</span>

<span class="token comment">//不可以将record定义的类声明为abstract的</span>
<span class="token comment">//abstract record Order(){</span>
<span class="token comment">//</span>
<span class="token comment">//}</span>

<span class="token comment">//不可以给record定义的类声明显式的父类（非Record类）</span>
<span class="token comment">//record Order() extends Thread{</span>
<span class="token comment">//</span>
<span class="token comment">//}</span>
</code></pre></div><p><strong>JDK15中第二次预览特性</strong></p> <p><strong>JDK16中转正特性</strong></p> <p>最终到JDK16中转正。</p> <p><code>记录不适合哪些场景</code></p> <p>record的设计目标是提供一种将数据建模为数据的好方法。它也不是 JavaBeans 的直接替代品，因为record的方法不符合 JavaBeans 的 get 标准。另外 JavaBeans 通常是可变的，而记录是不可变的。尽管它们的用途有点像，但记录并不会以某种方式取代 JavaBean。</p> <h3 id="_6-8-密封类"><a href="#_6-8-密封类" class="header-anchor">#</a> 6.8 密封类</h3> <p>背景：</p> <p>在 Java 中如果想让一个类不能被继承和修改，这时我们应该使用 <code>final</code> 关键字对类进行修饰。不过这种要么可以继承，要么不能继承的机制不够灵活，有些时候我们可能想让某个类可以被某些类型继承，但是又不能随意继承，是做不到的。Java 15 尝试解决这个问题，引入了 <code>sealed</code> 类，被 <code>sealed</code> 修饰的类可以指定子类。这样这个类就只能被指定的类继承。</p> <p><strong>JDK15的预览特性：</strong></p> <p>通过密封的类和接口来限制超类的使用，密封的类和接口限制其它可能继承或实现它们的其它类或接口。</p> <p>具体使用：</p> <ul><li><p>使用修饰符<code>sealed</code>，可以将一个类声明为密封类。密封的类使用保留关键字<code>permits</code>列出可以直接扩展（即extends）它的类。</p></li> <li><p><code>sealed</code> 修饰的类的机制具有传递性，它的子类必须使用指定的关键字进行修饰，且只能是 <code>final</code>、<code>sealed</code>、<code>non-sealed</code> 三者之一。</p></li></ul> <p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>java</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token keyword">permits</span> <span class="token class-name">Circle</span><span class="token punctuation">,</span> <span class="token class-name">Rectangle</span><span class="token punctuation">,</span> <span class="token class-name">Square</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token comment">//final表示Circle不能再被继承了</span>

<span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token keyword">permits</span> <span class="token class-name">TransparentRectangle</span><span class="token punctuation">,</span> <span class="token class-name">FilledRectangle</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">TransparentRectangle</span> <span class="token keyword">extends</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">FilledRectangle</span> <span class="token keyword">extends</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">non-sealed</span> <span class="token keyword">class</span> <span class="token class-name">Square</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token comment">//non-sealed表示可以允许任何类继承</span>
</code></pre></div><p><strong>JDK16二次预览特性</strong></p> <p><strong>JDK17中转正特性</strong></p> <h2 id="_7-api的变化"><a href="#_7-api的变化" class="header-anchor">#</a> 7. API的变化</h2> <h3 id="_7-1-optional类"><a href="#_7-1-optional类" class="header-anchor">#</a> 7.1 Optional类</h3> <p><strong>JDK8的新特性</strong></p> <p>到目前为止，臭名昭著的空指针异常是导致Java应用程序失败的最常见原因。以前，为了解决空指针异常，Google在著名的Guava项目引入了Optional类，通过检查空值的方式避免空指针异常。受到Google的启发，Optional类已经成为Java 8类库的一部分。</p> <p><code>Optional&lt;T&gt;</code> 类(java.util.Optional) 是一个容器类，它可以保存类型T的值，代表这个值存在。或者仅仅保存null，表示这个值不存在。如果值存在，则isPresent()方法会返回true，调用get()方法会返回该对象。</p> <p>Optional提供很多有用的方法，这样我们就不用显式进行空值检测。</p> <ul><li><p><code>创建Optional类对象的方法：</code></p></li> <li><p>static <T> Optional<T> empty() ：用来创建一个空的Optional实例</T></T></p> <ul><li>static <T> Optional<T> of(T value) ：用来创建一个Optional实例，value必须非空</T></T></li> <li><code>static &lt;T&gt; Optional&lt;T&gt; ofNullable(T value)</code> ：用来创建一个Optional实例，value可能是空，也可能非空</li></ul></li> <li><p><code>判断Optional容器中是否包含对象：</code></p> <ul><li>boolean isPresent() : 判断Optional容器中的值是否存在</li> <li>void ifPresent(Consumer&lt;? super T&gt; consumer) ：判断Optional容器中的值是否存在，如果存在，就对它进行Consumer指定的操作，如果不存在就不做</li></ul></li> <li><p><code>获取Optional容器的对象：</code></p></li> <li><p>T get(): 如果调用对象包含值，返回该值。否则抛异常。T get()与of(T value)配合使用</p></li> <li><p><code>T orElse(T other)</code>：orElse(T other) 与ofNullable(T value)配合使用，如果Optional容器中非空，就返回所包装值，如果为空，就用orElse(T other)other指定的默认值（备胎）代替</p></li> <li><p>T orElseGet(Supplier&lt;? extends T&gt; other) ：如果Optional容器中非空，就返回所包装值，如果为空，就用Supplier接口的Lambda表达式提供的值代替</p></li> <li><p>T orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier) ：如果Optional容器中非空，就返回所包装值，如果为空，就抛出你指定的异常类型代替原来的NoSuchElementException</p></li></ul> <p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>optional</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Optional</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestOptional</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> string <span class="token operator">=</span> opt<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//		System.out.println(opt.get());//java.util.NoSuchElementException: No value present</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> string <span class="token operator">=</span> opt<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">&quot;atguigu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> string <span class="token operator">=</span> opt<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> string <span class="token operator">=</span> opt<span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;值不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test9</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;Hello1&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断是否是纯字母单词，如果是，转为大写，否则保持不变</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> opt<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>s<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;[a-zA-Z]+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>这是JDK9-11的新特性</strong></p> <table><thead><tr><th><strong>新增方法</strong></th> <th><strong>描述</strong></th> <th><strong>新增的版本</strong></th></tr></thead> <tbody><tr><td>boolean isEmpty()</td> <td>判断value是否为空</td> <td>JDK  11</td></tr> <tr><td>ifPresentOrElse(Consumer&lt;? super T&gt; action, Runnable emptyAction)</td> <td>value非空，执行参数1功能；如果value为空，执行参数2功能</td> <td>JDK  9</td></tr> <tr><td>Optional<T> or(Supplier&lt;? extends Optional&lt;? extends T&gt;&gt; supplier)</T></td> <td>value非空，返回对应的Optional；value为空，返回形参封装的Optional</td> <td>JDK  9</td></tr> <tr><td>Stream<T> stream()</T></td> <td>value非空，返回仅包含此value的Stream；否则，返回一个空的Stream</td> <td>JDK  9</td></tr> <tr><td>T orElseThrow()</td> <td>value非空，返回value；否则抛异常NoSuchElementException</td> <td>JDK  10</td></tr></tbody></table> <h3 id="_7-2-string存储结构和api变更"><a href="#_7-2-string存储结构和api变更" class="header-anchor">#</a> 7.2 String存储结构和API变更</h3> <p><strong>这是JDK9的新特性。</strong></p> <p>产生背景：</p> <blockquote><p>Motivation
The current implementation of the String class stores characters in a char array, using two bytes (sixteen bits) for each character. Data gathered from many different applications indicates that strings are a major component of heap usage and, moreover, that most String objects contain only Latin-1 characters. Such characters require only one byte of storage, hence half of the space in the internal char arrays of such String objects is going unused.</p></blockquote> <p>使用说明：</p> <blockquote><h2 id="description"><a href="#description" class="header-anchor">#</a> Description</h2> <p>We propose to change the internal representation of the String class from a UTF-16 char array to a byte array plus an encoding-flag field. The new String class will store characters encoded either as ISO-8859-1/Latin-1 (one byte per character), or as UTF-16 (two bytes per character), based upon the contents of the string. The encoding flag will indicate which encoding is used.</p></blockquote> <p>结论：String 再也不用 char[] 来存储啦，改成了 byte[] 加上编码标记，节约了一些空间。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">String</span>
    <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Stable</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token punctuation">;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>拓展：StringBuffer 与 StringBuilder</p> <p>那StringBuffer 和 StringBuilder 是否仍无动于衷呢？</p> <blockquote><p>String-related classes such as AbstractStringBuilder, StringBuilder, and StringBuffer will be updated to use the same representation, as will the HotSpot VM's intrinsic string operations.</p></blockquote> <p><strong>JDK11新特性：新增了一系列字符串处理方法</strong></p> <table><thead><tr><th><strong>描述</strong></th> <th><strong>举例</strong></th></tr></thead> <tbody><tr><td>判断字符串是否为空白</td> <td>&quot;  &quot;.isBlank(); // true</td></tr> <tr><td>去除首尾空白</td> <td>&quot;  Javastack &quot;.strip(); // &quot;Javastack&quot;</td></tr> <tr><td>去除尾部空格</td> <td>&quot;  Javastack &quot;.stripTrailing(); // &quot; Javastack&quot;</td></tr> <tr><td>去除首部空格</td> <td>&quot;  Javastack &quot;.stripLeading(); // &quot;Javastack &quot;</td></tr> <tr><td>复制字符串</td> <td>&quot;Java&quot;.repeat(3);//  &quot;JavaJavaJava&quot;</td></tr> <tr><td>行数统计</td> <td>&quot;A\nB\nC&quot;.lines().count();  // 3</td></tr></tbody></table> <p><strong>JDK12新特性：String 实现了 Constable 接口</strong></p> <p>String源码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">String</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span><span class="token punctuation">,</span><span class="token class-name">Constable</span><span class="token punctuation">,</span> <span class="token class-name">ConstantDesc</span> <span class="token punctuation">{</span>
</code></pre></div><p>java.lang.constant.Constable接口定义了抽象方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Constable</span> <span class="token punctuation">{</span>
	<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">ConstantDesc</span><span class="token punctuation">&gt;</span></span> <span class="token function">describeConstable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Java 12 String 的实现源码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Returns an {@link Optional} containing the nominal descriptor for this
 * instance, which is the instance itself.
 *
 * @return an {@link Optional} describing the {@linkplain String} instance
 * @since 12
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">describeConstable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>很简单，其实就是调用 Optional.of 方法返回一个 Optional 类型。</p> <p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testDescribeConstable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;尚硅谷Java高级工程师&quot;</span><span class="token punctuation">;</span>
	<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">describeConstable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>optional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>结果输出：</p> <div class="language- extra-class"><pre class="language-text"><code>尚硅谷Java高级工程师
</code></pre></div><p><strong>JDK12新特性：String新增方法</strong></p> <p>String的transform(Function)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>input <span class="token operator">-&gt;</span> input <span class="token operator">+</span> <span class="token string">&quot; bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//foo bar</span>
</code></pre></div><p>或者</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>input <span class="token operator">-&gt;</span> input <span class="token operator">+</span> <span class="token string">&quot; bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//FOO BAR</span>
</code></pre></div><p>对应的源码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
* This method allows the application of a function to {@code this}
* string. The function should expect a single String argument
* and produce an {@code R} result.
* @since 12
*/</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">R</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> f<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在某种情况下，该方法应该被称为map()。</p> <p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;======test java 12 transform======&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;Java&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; Python&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; C++ &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	list1<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>element <span class="token operator">-&gt;</span> list2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">strip</span><span class="token punctuation">)</span>
								  <span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span>
								  <span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Hi,&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span>
				 <span class="token punctuation">)</span><span class="token punctuation">;</span>
	list2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>结果输出：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>test java <span class="token number">12</span> transform<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token class-name">Hi</span><span class="token punctuation">,</span><span class="token constant">JAVA</span>
<span class="token class-name">Hi</span><span class="token punctuation">,</span><span class="token constant">PYTHON</span>
<span class="token class-name">Hi</span><span class="token punctuation">,</span><span class="token class-name">C</span><span class="token operator">++</span>
</code></pre></div><p>如果使用Java 8的Stream特性，可以如下实现：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testTransform1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;======test before java 12 ======&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;Java  &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; Python&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; C++ &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stringStream <span class="token operator">=</span> list1<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>element <span class="token operator">-&gt;</span> element<span class="token punctuation">.</span><span class="token function">strip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>element <span class="token operator">-&gt;</span> <span class="token string">&quot;Hello,&quot;</span> <span class="token operator">+</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list2 <span class="token operator">=</span> stringStream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-3-jdk17-标记删除applet-api"><a href="#_7-3-jdk17-标记删除applet-api" class="header-anchor">#</a> 7.3 JDK17：标记删除Applet API</h3> <p>Applet API 提供了一种将 Java AWT/Swing 控件嵌入到浏览器网页中的方法。不过，目前 Applet 已经被淘汰。大部分人可能压根就没有用过 Applet。</p> <p>Applet API 实际上是无用的，因为所有 Web 浏览器供应商都已删除或透露计划放弃对 Java 浏览器插件的支持。Java 9 的时候，Applet API 已经被标记为过时，Java 17 的时候终于标记为删除了。</p> <p>具体如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>applet<span class="token punctuation">.</span></span>Applet</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>applet<span class="token punctuation">.</span></span>AppletStub</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>applet<span class="token punctuation">.</span></span>AppletContext</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>applet<span class="token punctuation">.</span></span>AudioClip</span>
<span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span></span>JApplet</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span>AppletInitializer</span>
</code></pre></div><h2 id="_8-其它结构变化"><a href="#_8-其它结构变化" class="header-anchor">#</a> 8.  其它结构变化</h2> <h3 id="_8-1-jdk9-underscore-下划线-使用的限制"><a href="#_8-1-jdk9-underscore-下划线-使用的限制" class="header-anchor">#</a> 8.1 JDK9：UnderScore(下划线)使用的限制</h3> <p>在java 8 中，标识符可以独立使用“_”来命名：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> _ <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>但是，在java 9 中规定“_”不再可以单独命名标识符了，如果使用，会报错：</p> <p><img alt="image-20220527233322495" data-src="images/image-20220527233322495.png" loading="lazy" class="lazy"></p> <h3 id="_8-2-jdk11-更简化的编译运行程序"><a href="#_8-2-jdk11-更简化的编译运行程序" class="header-anchor">#</a> 8.2 JDK11：更简化的编译运行程序</h3> <p>看下面的代码。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 编译</span>
javac <span class="token class-name">JavaStack</span><span class="token punctuation">.</span>java

<span class="token comment">// 运行</span>
java <span class="token class-name">JavaStack</span>
</code></pre></div><p>我们的认知里，要运行一个 Java 源代码必须先编译，再运行。而在 Java 11 版本中，通过一个 java 命令就直接搞定了，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>java JavaStack.java
</code></pre></div><p>注意点：</p> <ul><li>执行源文件中的第一个类，第一个类必须包含主方法。</li></ul> <h3 id="_8-3-gc方面新特性"><a href="#_8-3-gc方面新特性" class="header-anchor">#</a> 8.3 GC方面新特性</h3> <p>GC是Java主要优势之一。 然而，当GC停顿太长，就会开始影响应用的响应时间。随着现代系统中内存不断增长，用户和程序员希望JVM能够以高效的方式充分利用这些内存， 并且无需长时间的GC暂停时间。</p> <h4 id="_8-3-1-g1-gc"><a href="#_8-3-1-g1-gc" class="header-anchor">#</a> 8.3.1 G1 GC</h4> <p>JDK9以后默认的垃圾回收器是G1GC。</p> <p><strong>JDK10 : 为G1提供并行的Full GC</strong></p> <p>G1最大的亮点就是可以尽量的避免full gc。但毕竟是“尽量”，在有些情况下，G1就要进行full gc了，比如如果它无法足够快的回收内存的时候，它就会强制停止所有的应用线程然后清理。</p> <p>在Java10之前，一个单线程版的标记-清除-压缩算法被用于full gc。为了尽量减少full gc带来的影响，在Java10中，就把之前的那个单线程版的标记-清除-压缩的full gc算法改成了支持多个线程同时full gc。这样也算是减少了full gc所带来的停顿，从而提高性能。</p> <p>你可以通过<code>-XX:ParallelGCThreads</code>参数来指定用于并行GC的线程数。</p> <p><strong>JDK12：可中断的 G1 Mixed GC</strong></p> <p><strong>JDK12：增强G1，自动返回未用堆内存给操作系统</strong></p> <h4 id="_8-3-2-shenandoah-gc"><a href="#_8-3-2-shenandoah-gc" class="header-anchor">#</a> 8.3.2 Shenandoah GC</h4> <p><strong>JDK12：Shenandoah GC：低停顿时间的GC</strong></p> <p><img alt="image-20220528212254705" data-src="images/image-20220528212254705.png" loading="lazy" class="lazy"></p> <p>Shenandoah 垃圾回收器是 Red Hat 在 2014 年宣布进行的一项垃圾收集器研究项目 Pauseless GC 的实现，旨在<strong>针对 JVM 上的内存收回实现低停顿的需求</strong>。</p> <p>据 Red Hat 研发 Shenandoah 团队对外宣称，Shenandoah 垃圾回收器的暂停时间与堆大小无关，这意味着无论将堆设置为 200 MB 还是 200 GB，都将拥有一致的系统暂停时间，不过实际使用性能将取决于实际工作堆的大小和工作负载。</p> <p>Shenandoah GC 主要目标是 99.9% 的暂停小于 10ms，暂停与堆大小无关等。</p> <p>这是一个实验性功能，不包含在默认（Oracle）的OpenJDK版本中。</p> <p>Shenandoah开发团队在实际应用中的测试数据：</p> <p><img alt="image-20220528212323729" data-src="images/image-20220528212323729.png" loading="lazy" class="lazy"></p> <p><strong>JDK15：Shenandoah垃圾回收算法转正</strong></p> <p>Shenandoah垃圾回收算法终于从实验特性转变为产品特性，这是一个从 JDK 12 引入的回收算法，该算法通过与正在运行的 Java 线程同时进行疏散工作来减少 GC 暂停时间。Shenandoah 的暂停时间与堆大小无关，无论堆栈是 200 MB 还是 200 GB，都具有相同的一致暂停时间。</p> <p>Shenandoah在JDK12被作为experimental引入，在JDK15变为Production；之前需要通过<code>-XX:+UnlockExperimentalVMOptions</code> <code>-XX:+UseShenandoahGC</code>来启用，现在只需要<code>-XX:+UseShenandoahGC</code>即可启用</p> <h4 id="_8-3-3-革命性的-zgc"><a href="#_8-3-3-革命性的-zgc" class="header-anchor">#</a> 8.3.3 革命性的 ZGC</h4> <p><strong>JDK11：引入革命性的 ZGC</strong></p> <p>ZGC，这应该是JDK11最为瞩目的特性，没有之一。</p> <p>ZGC是一个并发、基于region、压缩型的垃圾收集器。</p> <p>ZGC的设计目标是：支持TB级内存容量，暂停时间低（&lt;10ms），对整个程序吞吐量的影响小于15%。 将来还可以扩展实现机制，以支持不少令人兴奋的功能，例如多层堆（即热对象置于DRAM和冷对象置于NVMe闪存），或压缩堆。</p> <p><strong>JDK13：ZGC:将未使用的堆内存归还给操作系统</strong></p> <p><strong>JDK14：ZGC on macOS和windows</strong></p> <ul><li><p>JDK14之前，ZGC仅Linux才支持。现在mac或Windows上也能使用ZGC了，示例如下：</p> <div class="language- extra-class"><pre class="language-text"><code>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC
</code></pre></div></li> <li><p>ZGC与Shenandoah目标高度相似，在尽可能对吞吐量影响不大的前提下，实现在任意堆内存大小下都可以把垃圾收集的停顿时间限制在<code>十毫秒以内</code>的低延迟。</p></li></ul> <p><img alt="image-20220528212414676" data-src="images/image-20220528212414676.png" loading="lazy" class="lazy"></p> <p><img alt="image-20220528212421319" data-src="images/image-20220528212421319.png" loading="lazy" class="lazy"></p> <p><strong>JDK15：ZGC 功能转正</strong></p> <p>ZGC是Java 11引入的新的垃圾收集器，经过了多个实验阶段，自此终于成为正式特性。</p> <p>但是这并不是替换默认的GC，默认的GC仍然还是G1；之前需要通过<code>-XX:+UnlockExperimentalVMOptions</code>、<code>-XX:+UseZGC</code>来启用ZGC，现在只需要<code>-XX:+UseZGC</code>就可以。相信不久的将来它必将成为默认的垃圾回收器。</p> <blockquote><p>ZGC的性能已经相当亮眼，用“令人震惊、革命性”来形容，不为过。未来将成为服务端、大内存、低延迟应用的首选垃圾收集器。</p></blockquote> <p>怎么形容Shenandoah和ZGC的关系呢？异同点大概如下：</p> <ul><li>相同点：性能几乎可认为是相同的</li> <li>不同点：ZGC是Oracle JDK的，根正苗红。而Shenandoah只存在于OpenJDK中，因此使用时需注意你的JDK版本</li></ul> <p><strong>JDK16：ZGC 并发线程处理</strong></p> <p>在线程的堆栈处理过程中，总有一个制约因素就是safepoints。在safepoints这个点，Java的线程是要暂停执行的，从而限制了GC的效率。</p> <blockquote><p>回顾：</p> <p>我们都知道，在之前，需要 GC 的时候，为了进行垃圾回收，需要所有的线程都暂停下来，这个暂停的时间我们称为 <strong>Stop The World</strong>。</p> <p>而为了实现 STW 这个操作， JVM 需要为每个线程选择一个点停止运行，这个点就叫做<strong>安全点（Safepoints）</strong>。</p></blockquote> <p>而ZGC的并发线程堆栈处理可以保证Java线程可以在GC safepoints的同时可以并发执行。它有助于提高所开发的Java软件应用程序的性能和效率。</p> <h2 id="_9-小结与展望"><a href="#_9-小结与展望" class="header-anchor">#</a> 9. 小结与展望</h2> <p>随着云计算和 AI 等技术浪潮，当前的计算模式和场景正在发生翻天覆地的变化，不仅对 Java 的发展速度提出了更高要求，也深刻影响着 Java 技术的发展方向。<strong>传统的大型企业或互联网应用，正在被云端、容器化应用、模块化的微服务甚至是函数(FaaS， Function-as-a-Service)所替代。</strong></p> <p>**Java 需要在新的计算场景下，改进开发效率。**比如，Java 代码虽然进行了一些类型推断等改进，更易用的集合 API 等，但仍然给开发者留下了过于刻板、形式主义的印象，这是一个长期的改进方向。</p> <p>Java虽然标榜面向对象编程，却毫不顾忌的加入<code>面向接口编程思想</code>，又扯出<code>匿名对象</code>的概念，每增加一个新的东西，对Java的根本（面向对象思想）的一次冲击。</p> <blockquote><p>士，不可不弘毅，任重而道远。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Java/Java新特性/1.html" class="prev">
        JDK8-17新特性（上）
      </a></span> <!----></p></div> </main></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.56b30d8d.js" defer></script><script src="/assets/js/2.86de0245.js" defer></script><script src="/assets/js/9.ef364674.js" defer></script>
  </body>
</html>
